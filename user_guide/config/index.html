

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../getting_started/">
      
      
        <link rel="next" href="../maintaining/">
      
      
      <link rel="icon" href="../../imgs/logo/neurobagel_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Configuring a node - Neurobagel</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  <script defer data-domain="neurobagel.org" src="https://plausible.neurobagel.org/js/script.js"></script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Neurobagel" class="md-header__button md-logo" aria-label="Neurobagel" data-md-component="logo">
      
  <img src="../../imgs/logo/neurobagel_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Neurobagel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuring a node
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/neurobagel/documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  User guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../data_models/variables/" class="md-tabs__link">
          
  
  
    
  
  Data models

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributing/CONTRIBUTING/" class="md-tabs__link">
          
  
  
    
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_help/" class="md-tabs__link">
        
  
  
    
  
  Getting help

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cite/" class="md-tabs__link">
        
  
  
    
  
  Citing Neurobagel

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Neurobagel" class="md-nav__button md-logo" aria-label="Neurobagel" data-md-component="logo">
      
  <img src="../../imgs/logo/neurobagel_logo.png" alt="logo">

    </a>
    Neurobagel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/neurobagel/documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    User guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Running cohort queries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Running cohort queries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../public_nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search the public nodes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to use the query tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Querying the API directly
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Setting up your own Neurobagel node
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Setting up your own Neurobagel node
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Configuring a node
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Configuring a node
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-services" class="md-nav__link">
    <span class="md-ellipsis">
      Available services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Available profiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#launching-a-profile" class="md-nav__link">
    <span class="md-ellipsis">
      Launching a profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-host-ports-for-services" class="md-nav__link">
    <span class="md-ellipsis">
      Default host ports for services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-security-relevant-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Change security relevant variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-local-node-names-and-urls-for-federation" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring local node names and URLs for federation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behind-a-reverse-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Behind a reverse proxy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maintaining/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintaining a node
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Annotating your data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Annotating your data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_prep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preparing phenotypic data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotation_tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Annotating phenotypic data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preparing_imaging_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preparing imaging data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating harmonized subject-level metadata
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Data models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_models/variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Harmonized variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_models/dictionaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Augmented BIDS data dictionaries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_models/graph_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data files for Neurobagel graphs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_models/term_naming_standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naming conventions for terms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to contribute
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/team/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Our team
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting help
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citing Neurobagel
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-services" class="md-nav__link">
    <span class="md-ellipsis">
      Available services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Available profiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#launching-a-profile" class="md-nav__link">
    <span class="md-ellipsis">
      Launching a profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-host-ports-for-services" class="md-nav__link">
    <span class="md-ellipsis">
      Default host ports for services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-security-relevant-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Change security relevant variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-local-node-names-and-urls-for-federation" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring local node names and URLs for federation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behind-a-reverse-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Behind a reverse proxy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Configuring a node</h1>

<p>Neurobagel is designed to be easily deployed with a single command without deep configuration.
In many cases however, you will want to customize your deployment to fit your needs.</p>
<p>If you already have a running Neurobagel node, 
after making any configuration changes 
(including changing the data you want to be available in the graph database), 
follow the instructions to <a href="../maintaining/#restarting-services-after-an-update">restart your services</a> 
for the changes to take effect.</p>
<h2 id="deployment">Deployment</h2>
<h3 id="available-services">Available services</h3>
<p>The Neurobagel Docker Compose recipe includes several services
and coordinates them to work together:</p>
<p>(In parentheses are the names of services within the Docker Compose stack)</p>
<ul>
<li><strong><a href="../api/">Neurobagel node API/n-API</a></strong> (<code>api</code>): The API that communicates with a single graph store and determines 
    how detailed the response to a query should be from that graph.</li>
<li><strong>Graph store</strong> (<code>graph</code>): A third-party RDF store that stores Neurobagel-harmonized data to be queried. At the moment our recipe uses the free tier
    of <a href="https://db-engines.com/en/system/GraphDB">GraphDB</a> for this.</li>
<li><strong>Neurobagel federation/f-API</strong> (<code>federation</code>): A special API that can federate over one or more
    Neurobagel nodes to provide a single point of access to multiple distributed databases.
    By default it will federate over all public nodes and any local nodes you specify. </li>
<li><strong><a href="../query_tool/">Neurobagel query tool</a></strong> (<code>query_federation</code>): A web app that provides a graphical interface for users to query a 
    federation API and view the results from one or more nodes. Because the query tool is a static app and is run locally
    in the user's browser, this service simply hosts the app.</li>
</ul>
<h3 id="available-profiles">Available profiles</h3>
<p>Neurobagel offers different deployment profiles that allow you to spin up specific combinations of services (listed below), depending on your use case.</p>
<ol>
<li>
<p><code>full_stack</code>: Best profile to get started with Neurobagel. 
    It includes all services you need to run a local Neurobagel node and have the ability to query public nodes, along with a graphical query tool.</p>
<ul>
<li><code>api</code></li>
<li><code>graph</code></li>
<li><code>federation</code></li>
<li><code>query_tool</code></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This is the <strong>default profile</strong> if you don't specify one.</p>
<p>By default, this profile will also federate over all publicly accessible Neurobagel nodes, although this behaviour can be disabled in the f-API using the environment variable <a href="#environment-variables"><code>NB_FEDERATE_REMOTE_PUBLIC_NODES</code></a>.</p>
</div>
</li>
<li>
<p><code>local_node</code>: Best profile if you want to run a standalone Neurobagel node
    but rely on a separate deployment for providing federation and a graphical query tool (such as Neurobagel's own hosted public instances).</p>
<ul>
<li><code>api</code></li>
<li><code>graph</code></li>
</ul>
</li>
<li>
<p><code>local_federation</code>: Best profile if you already have multiple standalone (local or non-publicly-accessible) Neurobagel node
    deployments running and you now want to provide federation over them.  </p>
<ul>
<li><code>federation</code></li>
<li><code>query_tool</code></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you only want to federate over a single local node and all public Neurobagel nodes,
we recommend using the <code>full_stack</code> profile to set up your node and federation in one step.
If you choose to use the <code>local_federation</code> profile, 
you will have to <a href="#configuring-local-node-names-and-urls-for-federation">manually configure your <code>local_nb_nodes.json</code> file</a>.</p>
</div>
</li>
</ol>
<h4 id="launching-a-profile">Launching a profile</h4>
<p>You can then launch a specific profile using the <code>--profile</code> or  <code>-p</code> flag with <code>docker compose</code>, e.g.:
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>--profile<span class="w"> </span>full_stack<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
If no profile is specified, <code>docker compose up -d</code> will start the services for the default profile, <code>full_stack</code>.</p>
<p>Take a look at the <a href="../getting_started/">getting started guide</a> for more information setting up for a first launch.</p>
<h3 id="default-host-ports-for-services">Default host ports for services</h3>
<details class="warning">
<summary>Don't publicly expose service ports on a production server</summary>
<p>We're providing the default ports as a reference for local deployment, testing, and for scenarios
where you do not want to use the
<a href="#behind-a-reverse-proxy">provided reverse proxy deployment recipes</a>.</p>
<p>Where possible, we <strong>strongly recommend</strong> that you avoid opening service ports to a public network
and instead use our
<a href="#behind-a-reverse-proxy">reverse proxy deployment recipe</a>.</p>
</details>
<p>Neurobagel node services run inside Docker containers. Each service listens on an <em>internal port</em> within its container and 
exposes a <em>host port</em> that makes it accessible from the host machine. Below, we list the default <em>host ports</em> for each service
when running in a fresh deployment following our <a href="../getting_started/">getting started guide</a>, 
along with the <a href="#environment-variables">environment variables</a> that can be used to configure them.</p>
<ul>
<li><code>api</code> (the node API)<ul>
<li>environment variable: <code>NB_NAPI_PORT_HOST</code></li>
<li>default host port: <code>8000</code></li>
</ul>
</li>
<li><code>federation</code> (the federation API)<ul>
<li>environment variable: <code>NB_FAPI_PORT_HOST</code></li>
<li>default host port: <code>8080</code></li>
</ul>
</li>
<li><code>query_tool</code> (the graphical query web interface)<ul>
<li>environment variable: <code>NB_QUERY_PORT_HOST</code></li>
<li>default host port: <code>3000</code></li>
</ul>
</li>
<li><code>graph</code> (the internal graph database)<ul>
<li>environment variable: <code>NB_GRAPH_PORT_HOST</code></li>
<li>default host port: <code>7200</code></li>
</ul>
</li>
</ul>
<h2 id="environment-variables">Environment variables</h2>
<p>Below are all the possible Neurobagel environment variables that can be set in <code>.env</code>.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Environment variable</th>
<th style="text-align: left;">Default needs change?</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Default value if not set</th>
<th style="text-align: left;">Used in these installation modes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>NB_GRAPH_USERNAME</code></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Username to set for the graph database user.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_GRAPH_SECRETS_PATH</code></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Path to files containing the secure passwords to set for the admin user (NB_GRAPH_ADMIN_PASSWORD.txt) and graph database user (NB_GRAPH_PASSWORD.txt).</td>
<td style="text-align: left;"><code>./secrets</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_GRAPH_DB</code></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Name to give your graph database (e.g., for a GraphDB database, use the format <code>repositories/{database_name}</code>)</td>
<td style="text-align: left;"><code>repositories/my_db</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_GRAPH_MEMORY</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The maximum amount of memory that can be used by graph. Equivalent to setting the <code>-Xmx</code> parameter on the JVM. Value should be a number followed directly by a letter denoting the size. E.g. <code>264m</code> for 264 MB, <code>2g</code> for 2 GB. (For more info, see https://graphdb.ontotext.com/documentation/10.8/requirements.html#hardware-sizing.)</td>
<td style="text-align: left;"><code>2g</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>LOCAL_GRAPH_DATA</code></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Path on your filesystem to the JSONLD files you want to upload to the graph database</td>
<td style="text-align: left;"><code>./data</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_GRAPH_PORT_HOST</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Port number on the <em>host machine</em> to map the graph server container port to</td>
<td style="text-align: left;"><code>7200</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_NAPI_ALLOWED_ORIGINS</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Origins allowed to make cross-origin resource sharing requests. Multiple origins must be separated with spaces in a single string enclosed in quotes.</td>
<td style="text-align: left;"><code>""</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_RETURN_AGG</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether to return only aggregate, dataset-level query results (excluding subject/session-level attributes). One of [true, false]</td>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_MIN_CELL_SIZE</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Minimum number of matching subjects required for a dataset to be returned as a query match. Datasets with matching subjects &lt;= this number will be excluded from query results.</td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_NAPI_TAG</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Docker image tag for the Neurobagel node API</td>
<td style="text-align: left;"><code>latest</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_NAPI_PORT_HOST</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Port number on the <em>host machine</em> to map the Neurobagel node API container port to</td>
<td style="text-align: left;"><code>8000</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_NAPI_BASE_PATH</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">(If using reverse proxy) The URL path where the node API is served from. Do not include a trailing slash.</td>
<td style="text-align: left;"><code>""</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_FAPI_TAG</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Docker image tag for the Neurobagel federation API</td>
<td style="text-align: left;"><code>latest</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_FAPI_PORT_HOST</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Port number on the <em>host machine</em> to map the Neurobagel federation API container port to</td>
<td style="text-align: left;"><code>8080</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_FEDERATE_REMOTE_PUBLIC_NODES</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">If "True", include public nodes in federation. If "False", only locally specified nodes in <code>local_nb_nodes.json</code> are queried.</td>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_FAPI_BASE_PATH</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">(If using reverse proxy) The URL path where the federation API is served from. Do not include a trailing slash.</td>
<td style="text-align: left;"><code>""</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_QUERY_TAG</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Docker image tag for the query tool</td>
<td style="text-align: left;"><code>latest</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_QUERY_PORT_HOST</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Port number used by the <code>query_tool</code> on the host machine</td>
<td style="text-align: left;"><code>3000</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_API_QUERY_URL</code></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">URL (and port number, if needed) of the Neurobagel API that the query tool will send its requests to. The query tool sends requests from a user's machine, so ensure the API URL is provided <em>as a user would access it from their own machine</em>. See also the <a href="https://github.com/neurobagel/query-tool?tab=readme-ov-file#set-the-environment-variables">query tool README</a>.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_QUERY_APP_BASE_PATH</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">(If using reverse proxy) The URL path for the query tool, determines the specific URL at which the app should be rendered for users to access it</td>
<td style="text-align: left;"><code>/</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_QUERY_HEADER_SCRIPT</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">(Experimental, for development environments only) Custom script to add to the header section of the query tool site, such as for a GDPR-aware analytics tool.</td>
<td style="text-align: left;"><code>""</code></td>
<td style="text-align: left;">Docker</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_ENABLE_AUTH</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;"><strong>(Experimental, for development environments only)</strong> Whether to enable authentication for cohort queries. One of [true, false]</td>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">Docker, Python</td>
</tr>
<tr>
<td style="text-align: left;"><code>NB_QUERY_CLIENT_ID</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;"><strong>(Experimental, for development environments only)</strong> OAuth client ID for the query tool. Required if NB_ENABLE_AUTH is set to true.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Docker, Python</td>
</tr>
</tbody>
</table>
<details class="warning">
<summary>Ensure that shell variables do not clash with <code>.env</code> file</summary>
<p>If the shell you run <code>docker compose</code> from already has any 
shell variable of the same name set, 
the shell variable will take precedence over the configuration
of <code>.env</code>!
In this case, make sure to <code>unset</code> the local variable first.</p>
<p>For more information, see <a href="https://docs.docker.com/compose/environment-variables/envvars-precedence/">Docker's environment variable precedence</a>.</p>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Double check that any environment variables you have customized in <code>.env</code> are resolved with your expected values using the command <code>docker compose config</code>.</p>
</div>
<h3 id="change-security-relevant-variables">Change security relevant variables</h3>
<p>The graph store (GraphDB instance) in a Neurobagel node is secured with password-based access and includes two users: an <code>admin</code> superuser and a regular database user, both of which are automatically configured by the Neurobagel deployment recipe.
Passwords for both users are defined via files in the <code>./secrets</code> directory of the recipes repository, while the regular database username is set through an environment variable in <code>.env</code> file.</p>
<p>For security and best practice purposes, we recommend changing the following values from their defaults if you are using a deployment profile that includes a graph store:</p>
<ol>
<li>
<p>In your <code>.env</code>, <strong>set a custom username and database name for your graph store</strong> by editing the following variables:</p>
<ul>
<li><code>NB_GRAPH_USERNAME</code></li>
<li><code>NB_GRAPH_DB</code></li>
</ul>
</li>
<li>
<p>In the (<a href="https://github.com/neurobagel/recipes/tree/main/secrets"><code>./secrets</code></a> directory, <strong>change the default passwords</strong> by replacing the contents of the file <code>NB_GRAPH_ADMIN_PASSWORD.txt</code> for the <code>admin</code> superuser, and the file <code>NB_GRAPH_PASSWORD.txt</code> for the graph database user (corresponding to <code>NB_GRAPH_USERNAME</code>).</p>
<ul>
<li>To generate a random password in the terminal, you can use:
  <div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>rand<span class="w"> </span>-hex<span class="w"> </span><span class="m">16</span>
</code></pre></div></li>
<li>(Optional) You can change the directory where your password files are stored by editing the <code>NB_GRAPH_SECRETS_PATH</code> variable in <code>.env</code>.</li>
</ul>
<details class="info">
<summary>Graph store passwords are not meant for node users!</summary>
<p>The <code>admin</code> user and graph database user credentials are intended solely for internal use by the deployment recipe scripts that automatically set up and update the graph store, 
or for a node administrator to interact directly with the graph store.
These credentials also secure internal communication between your graph store and its node API,
ensuring that node users cannot query your graph directly.
GraphDB user credentials are not intended for use by a general node query user.</p>
</details>
<details class="info">
<summary>Passwords are handled as Docker secrets</summary>
<p>The contents of <code>NB_GRAPH_ADMIN_PASSWORD.txt</code> and <code>NB_GRAPH_PASSWORD.txt</code> are passed to Neurobagel containers as <a href="https://docs.docker.com/reference/compose-file/secrets/">Docker secrets</a>.
This ensures that your passwords are not exposed in the container logs or in the <code>docker-compose.yml</code> file.</p>
<p>Do not share your password files with others.</p>
</details>
</li>
<li>
<p><strong>Review and change as needed</strong> the following variables in <code>.env</code> based on your data sharing requirements:</p>
<ul>
<li><code>NB_RETURN_AGG</code></li>
<li><code>NB_MIN_CELL_SIZE</code></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>These variables are modifiable after node initialization; you can <a href="../maintaining/#restarting-services-after-an-update">change their values at any time</a>.</p>
</div>
</li>
<li>
<p>If you've previously launched a Neurobagel Docker Compose stack following the <a href="../getting_started/#the-neurobagel-node-deployment-recipe">Getting started</a> instructions,
    you'll need to <a href="../maintaining/#resetting-your-graphdb-instance">reset your graph store</a> for any changes you have made to user credentials to take effect (steps 1-2 above). 
    Don't worry, any other configuration changes you've already made will be applied when you re-launch your node.</p>
</li>
</ol>
<h2 id="configuring-local-node-names-and-urls-for-federation">Configuring local node names and URLs for federation</h2>
<p>When using a deployment profile that provides federation (i.e., includes the federation API), 
you can configure the URLs and display names of the <strong>node APIs</strong> of any local nodes you wish to federate over in the file <code>local_nb_nodes.json</code>. 
This file is read by the f-API.</p>
<p>Each node to be federated over is defined using a dictionary with two key-value pairs:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;NodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;DISPLAY NAME OF NODE&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ApiURL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;URL OF NODE API&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title"><code>ApiURL</code> must include the protocol (<code>http://</code> or <code>https://</code>)</p>
</div>
<p>If you are only running a single node, or only want to federate across your local node and the public Neurobagel nodes, 
you <strong>do not need</strong> to modify the default <code>ApiURL</code> in <code>local_nb_nodes.json</code>.
However, you may want to customize your node's <code>NodeName</code>.</p>
<p>Notes:</p>
<ul>
<li><code>NodeName</code> can be any string, and determines how the node appears in the node selection dropdown in the query tool</li>
<li>To add more local nodes to federate over, simply add more dictionaries to <code>local_nb_nodes.json</code>, and ensure the dictionaries are wrapped in a list <code>[]</code> (see example below)</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Nodes that do not need to be manually configured</p>
<p>We maintain a list of publicly accessible Neurobagel nodes 
<a href="https://github.com/neurobagel/menu/blob/main/node_directory/neurobagel_public_nodes.json">here</a>.
By default, every new f-API will look up this list
on startup and include it in its internal list of nodes to
federate over (this can be disabled using the environment variable <a href="#environment-variables"><code>NB_FEDERATE_REMOTE_PUBLIC_NODES</code></a>).
This means that <strong>you do not have to manually add these public nodes</strong> to your <code>local_nb_nodes.json</code> file.</p>
</div>
<p><strong>Example:</strong> Assume there are two local nodes already running on different servers of your institutional network:</p>
<ul>
<li>a node named <code>"My Institute"</code> running on your local computer (<code>localhost</code>), on port <code>8000</code> </li>
<li>a node named <code>"Node Recruitment"</code> running on a different computer with the local IP <code>192.168.0.1</code>, listening on the default HTTP port <code>80</code> </li>
</ul>
<p>To set up federation across both nodes, you would configure <code>local_nb_nodes.json</code> as follows:
<div class="highlight"><span class="filename">local_nb_nodes.json</span><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;NodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My Institute&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ApiURL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://neurobagel.myinstitute.edu&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;NodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node Recruitment&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ApiURL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://192.168.0.1&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div></p>
<details class="warning">
<summary>Do not use <code>localhost</code>/<code>127.0.0.1</code> in <code>local_nb_nodes.json</code></summary>
<p>Even if the local node API(s) you are federating over are running 
on the same host machine as your federation API, 
you cannot use <code>localhost</code> for the <code>ApiURL</code> and must instead provide a network-accessible URL, IP address, or container name.
For an example, see the configuration for the node called <code>"My Institute"</code> above.</p>
</details>
<details class="warning">
<summary>Be careful to not use your federation API's own address for <code>ApiURL</code>!</summary>
<p>This will cause an infinite request loop that will likely overload your service, as an f-API will be repeatedly making requests to itself.</p>
</details>
<h2 id="behind-a-reverse-proxy">Behind a reverse proxy</h2>
<div class="admonition warning">
<p class="admonition-title">These steps are for advanced users and production deployments</p>
</div>
<p>To make your Neurobagel node services (node API, query tool, etc.) accessible via custom URLs
(e.g. <code>https://www.myfirstnode.org/query</code>) rather than a server IP address and port
(e.g. <code>http://192.168.0.1:3000</code>) as shown in in the <a href="../getting_started/">getting started guide</a>, 
you will need to set up a reverse proxy such as <a href="https://nginx.org/en/docs/beginners_guide.html">NGINX</a> or
<a href="https://caddyserver.com/docs/quick-starts/reverse-proxy">Caddy</a>. 
This will route incoming requests for custom URLs to the Neurobagel services deployed on your server. </p>
<p>The <a href="https://github.com/neurobagel/recipes/">Neurobagel <code>recipes</code> repository</a>
includes pre-configured Docker Compose files for both NGINX and Caddy,
each of which can be used to launch a reverse proxy server alongside the services in your Neurobagel node.
The reverse proxy setup will then automatically handle routing 
and also manage and renew SSL certificates (providing secure HTTPS connections) for node services.</p>
<ol>
<li>
<p>If you haven't already, follow the <a href="../getting_started/#the-neurobagel-node-deployment-recipe">steps</a>
to clone and minimally configure the services in the <a href="https://github.com/neurobagel/recipes">Neurobagel deployment recipe</a>.</p>
</li>
<li>
<p>Ensure you have already registered your desired domain(s) with a DNS provider and configured the DNS settings to resolve correctly to your host machine.</p>
</li>
<li>
<p>Ensure ports 80 and 443 are open on the host machine where your Docker Compose stack is running.
These are the ports your reverse proxy will listen on for incoming HTTP and HTTPS traffic.</p>
</li>
</ol>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="nginx" name="__tabbed_1" type="radio" /><input id="caddy" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="nginx">NGINX</label><label for="caddy">Caddy</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol start="4">
<li>
<p>In your local <code>docker-compose-nginx.yml</code> file, for <strong>each</strong> service
(i.e. <code>api</code>, <code>federation</code>, and <code>query_federation</code>),</p>
<ol>
<li>Locate the <code>environment</code> section for that service </li>
<li>
<p>Update the value of the following variables to the custom domain that specific service will use:</p>
<ul>
<li><code>VIRTUAL_HOST</code></li>
<li><code>LETSENCRYPT_HOST</code></li>
</ul>
<p>Both variables must have the same value for a given service, and must not include a protocol (<code>http://</code> or <code>https://</code>).</p>
</li>
<li>
<p>(Optional) To host services on different subpaths instead of different subdomains (e.g., <code>myinstitute.org/service1</code> instead of <code>service1.myinstitute.org</code>), 
<strong>do not include the subpath in the <code>VIRTUAL_HOST</code> or <code>LETSENCRYPT_HOST</code> values</strong>. 
Instead, update the corresponding <code>XXX_BASE_PATH</code> variables for the services in the <code>.env</code> file.
The full list of service-specific base path variables can be found <a href="./#environment-variables">here</a>.</p>
<p>For example, to host your node API at <code>myinstitute.org/node</code>:</p>
<div class="highlight"><span class="filename">docker-compose-nginx.yml</span><pre><span></span><code><span class="nn">...</span>
<span class="nt">api</span><span class="p">:</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">VIRTUAL_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myinstitute.org</span>
<span class="w">    </span><span class="nt">LETSENCRYPT_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myinstitute.org</span>
<span class="nn">...</span>
</code></pre></div>
<div class="highlight"><span class="filename">.env</span><pre><span></span><code>...
<span class="nv">NB_NAPI_BASE_PATH</span><span class="o">=</span><span class="s2">&quot;/node&quot;</span>
...
</code></pre></div>
</li>
</ol>
<details class="warning">
<summary>Do not change the <code>VIRTUAL_PATH</code> and <code>VIRTUAL_PORT</code> variables</summary>
<p>You can look at the <a href="https://github.com/nginx-proxy/nginx-proxy/tree/main/docs#virtual-hosts-and-ports">NGINX-Proxy documentation</a> to learn more about how these variables work.</p>
</details>
</li>
<li>
<p>In your <code>.env</code> file, set <code>NB_API_QUERY_URL</code> to your custom URL for the <strong>federation API</strong>, including any subpath if used. 
This URL must always begin with <code>https://</code>.</p>
<p>Example:
<div class="highlight"><span class="filename">.env</span><pre><span></span><code>...
<span class="nv">NB_API_QUERY_URL</span><span class="o">=</span><span class="s2">&quot;https://myinstitute.org/federate&quot;</span>
...
</code></pre></div></p>
</li>
<li>
<p>Finally, launch your node by explicitly referencing the custom Docker Compose file:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-nginx.yml<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="admonition note">
<p class="admonition-title">You do not need to edit the <code>docker-compose-caddy.yml</code> file directly.</p>
</div>
<ol start="4">
<li>In your local <code>recipes/config/caddy/Caddyfile</code>,
change the default URL for each service to the URL you want to use for that service.
Follow the comments in the file for guidance.</li>
</ol>
<details class="note">
<summary>For more complex reverse proxy setups, refer to the Caddy documentation</summary>
<p>The <a href="https://caddyserver.com/docs/caddyfile">Caddy documentation</a> has more detailed information
on subdirectory routing and other configuration options.</p>
</details>
<ol start="5">
<li>
<p>Finally, launch your node by explicitly referencing the custom Docker Compose file:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-caddy.yml<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
</li>
</ol>
</div>
</div>
</div>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../getting_started/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting started">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Getting started
              </div>
            </div>
          </a>
        
        
          
          <a href="../maintaining/" class="md-footer__link md-footer__link--next" aria-label="Next: Maintaining a node">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Maintaining a node
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.expand", "content.tabs.link", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>